<p-table [value]="authors" [loading]="loading" dataKey="id" [attr.data-testid]="TEST_IDS.AUTHORS.AUTHORS_TABLE">
  <ng-template pTemplate="header">
    <tr [attr.data-testid]="TEST_IDS.AUTHORS.AUTHORS_TABLE_HEADER">
      <th [attr.data-testid]="TEST_IDS.AUTHORS.AUTHORS_TABLE_NAME_COLUMN">Name</th>
      <th [attr.data-testid]="TEST_IDS.AUTHORS.AUTHORS_TABLE_BIRTH_DATE_COLUMN">Birth Date</th>
      <th [attr.data-testid]="TEST_IDS.AUTHORS.AUTHORS_TABLE_NATIONALITY_COLUMN">Nationality</th>
      <th [attr.data-testid]="TEST_IDS.AUTHORS.AUTHORS_TABLE_BOOKS_COLUMN">Books</th>
      <th [attr.data-testid]="TEST_IDS.AUTHORS.AUTHORS_TABLE_MAGAZINES_COLUMN">Magazines</th>
      <th>Actions</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-author>
    <tr [attr.data-testid]="TEST_IDS.AUTHORS.AUTHORS_TABLE_ROW">
      <td>{{ author.name }}</td>
      <td>{{ author.birthDate }}</td>
      <td>{{ author.nationality }}</td>
      <td>
        <ng-container *ngFor="let book of author.books; let last = last">
          <span>{{ book.title }}<span *ngIf="!last">, </span></span>
        </ng-container>
      </td>
      <td>
        <ng-container *ngFor="let mag of author.magazines; let last = last">
          <span>{{ mag.title }}<span *ngIf="!last">, </span></span>
        </ng-container>
      </td>
      <td>
        <button pButton icon="pi pi-pencil" class="p-button-rounded p-button-text" (click)="openEdit(author)"
          [attr.data-testid]="TEST_IDS.AUTHORS.AUTHOR_EDIT_BUTTON">
        </button>

        <button pButton icon="pi pi-trash" class="p-button-rounded p-button-danger p-button-text"
          (click)="confirmDeleteAuthor(author)" [attr.data-testid]="TEST_IDS.AUTHORS.AUTHOR_DELETE_BUTTON">
        </button>
      </td>
    </tr>
  </ng-template>
</p-table>

<p-paginator [rows]="pageSize" [totalRecords]="totalRecords" [first]="page * pageSize"
  (onPageChange)="onPageChange($event)" [attr.data-testid]="TEST_IDS.AUTHORS.AUTHORS_PAGINATOR">
</p-paginator>

<button pButton label="Add Author" icon="pi pi-plus" (click)="openNew()"
  [attr.data-testid]="TEST_IDS.AUTHORS.ADD_AUTHOR_BUTTON"></button>

<p-dialog [(visible)]="displayDialog" [modal]="true" [closable]="false"
  [header]="isEdit ? 'Edit Author' : 'Add Author'" [attr.data-testid]="TEST_IDS.AUTHORS.AUTHOR_DIALOG">
  <form (ngSubmit)="save()" #authorForm="ngForm">
    <div class="p-fluid">
      <div class="p-field">
        <label for="name">Name</label>
        <input id="name" type="text" pInputText [(ngModel)]="form.name" name="name" required minlength="2"
          maxlength="100" #name="ngModel" [attr.data-testid]="TEST_IDS.AUTHORS.AUTHOR_NAME_INPUT" />
        <div *ngIf="name.invalid && (name.dirty || name.touched)" class="p-error" [attr.data-testid]="TEST_IDS.AUTHORS.AUTHOR_NAME_ERROR">
          <div *ngIf="name.errors?.['required']" [attr.data-testid]="TEST_IDS.AUTHORS.AUTHOR_NAME_REQUIRED_ERROR">Name is required.</div>
          <div *ngIf="name.errors?.['minlength']" [attr.data-testid]="TEST_IDS.AUTHORS.AUTHOR_NAME_MIN_LENGTH_ERROR">Name must be at least 2 characters.</div>
          <div *ngIf="name.errors?.['maxlength']" [attr.data-testid]="TEST_IDS.AUTHORS.AUTHOR_NAME_MAX_LENGTH_ERROR">Name cannot exceed 100 characters.</div>
        </div>
      </div>

      <div class="p-field">
        <label for="birthDate">Birth Date</label>
        <input id="birthDate" type="date" pInputText [(ngModel)]="form.birthDate" name="birthDate"
          [attr.data-testid]="TEST_IDS.AUTHORS.AUTHOR_BIRTH_DATE_INPUT" />
      </div>

      <div class="p-field">
        <label for="nationality">Nationality</label>
        <input id="nationality" type="text" pInputText [(ngModel)]="form.nationality" name="nationality" maxlength="50"
          #nationality="ngModel" [attr.data-testid]="TEST_IDS.AUTHORS.AUTHOR_NATIONALITY_INPUT" />
        <div *ngIf="nationality.invalid && (nationality.dirty || nationality.touched)" class="p-error" [attr.data-testid]="TEST_IDS.AUTHORS.AUTHOR_NATIONALITY_ERROR">
          <div *ngIf="nationality.errors?.['maxlength']" [attr.data-testid]="TEST_IDS.AUTHORS.AUTHOR_NATIONALITY_MAX_LENGTH_ERROR">Nationality cannot exceed 50 characters.</div>
        </div>
      </div>
    </div>

    <div class="p-d-flex p-jc-end">
      <button pButton type="submit" label="Save"
        [attr.data-testid]="TEST_IDS.AUTHORS.AUTHOR_SAVE_BUTTON"></button>
      <button pButton type="button" label="Cancel" class="p-button-secondary" (click)="displayDialog = false"
        [attr.data-testid]="TEST_IDS.AUTHORS.AUTHOR_CANCEL_BUTTON"></button>
    </div>
  </form>
</p-dialog>

<app-confirm-dialog [visible]="confirmDelete" message="Are you sure you want to delete this author?"
  (accept)="deleteAuthor()" (reject)="confirmDelete = false"
  [attr.data-testid]="TEST_IDS.AUTHORS.AUTHOR_DELETE_CONFIRM"></app-confirm-dialog>