<p-table [value]="books" [loading]="loading" dataKey="id" [attr.data-testid]="'books-table'">
  <ng-template pTemplate="header" [attr.data-testid]="'books-table-header'">
    <tr>
      <th [attr.data-testid]="'books-table-title-column'">Title</th>
      <th [attr.data-testid]="'books-table-isbn-column'">ISBN</th>
      <th [attr.data-testid]="'books-table-publication-date-column'">Publication Date</th>
      <th [attr.data-testid]="'books-table-author-column'">Author</th>
      <th [attr.data-testid]="'books-table-actions-column'">Actions</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-book [attr.data-testid]="'books-table-body'">
    <tr [attr.data-testid]="'books-table-row'">
      <td>{{ book.title }}</td>
      <td>{{ book.isbn }}</td>
      <td>{{ book.publicationDate }}</td>
      <td>{{ book.author.name }}</td>
      <td>
        <button pButton icon="pi pi-pencil" (click)="openEdit(book)" class="p-button-text" [attr.data-testid]="'edit-book-button'"></button>
        <button pButton icon="pi pi-trash" (click)="confirmDeleteBook(book)" class="p-button-text p-button-danger" [attr.data-testid]="'delete-book-button'"></button>
      </td>
    </tr>
  </ng-template>
</p-table>
<p-paginator
  [rows]="pageSize"
  [totalRecords]="totalRecords"
  [first]="page * pageSize"
  (onPageChange)="onPageChange($event)"
  [attr.data-testid]="'books-paginator'">
</p-paginator>

<button pButton label="Add Book" icon="pi pi-plus" (click)="openNew()" [attr.data-testid]="'add-book-button'"></button>

<p-dialog [(visible)]="displayDialog" [modal]="true" [closable]="false" header="{{ isEdit ? 'Edit Book' : 'Add Book' }}" [attr.data-testid]="'book-dialog'">
  <form (ngSubmit)="save()" #bookForm="ngForm">
    <div class="p-fluid">
      <div class="p-field">
        <label for="title">Title</label>
        <input id="title" type="text" pInputText [(ngModel)]="form.title" name="title" required [attr.data-testid]="'book-title-input'" />
      </div>
      <div class="p-field">
        <label for="isbn">ISBN</label>
        <input id="isbn" type="text" pInputText [(ngModel)]="form.isbn" name="isbn" required [attr.data-testid]="'book-isbn-input'" />
      </div>
      <div class="p-field">
        <label for="publicationDate">Publication Date</label>
        <input id="publicationDate" type="date" pInputText [(ngModel)]="form.publicationDate" name="publicationDate" required [attr.data-testid]="'book-publication-date-input'" />
      </div>
      <div class="p-field">
        <label for="authorId">Author ID</label>
        <input id="authorId" type="number" pInputText [(ngModel)]="form.authorId" name="authorId" required [attr.data-testid]="'book-author-select'" />
      </div>
    </div>
    <div class="p-d-flex p-jc-end">
      <button pButton type="submit" label="Save" [disabled]="bookForm.invalid" [attr.data-testid]="'book-save-button'"></button>
      <button pButton type="button" label="Cancel" class="p-button-secondary" (click)="displayDialog = false" [attr.data-testid]="'book-cancel-button'"></button>
    </div>
  </form>
</p-dialog>

<app-confirm-dialog [visible]="confirmDelete" message="Are you sure you want to delete this book?" (accept)="deleteBook()" (reject)="confirmDelete = false" [attr.data-testid]="'book-delete-confirm'"></app-confirm-dialog> 